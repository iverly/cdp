# Cloud Design Patterns

## Overview

This microservices-based application is an online store that sells items specifically for DevOps students. We have implemented a saga pattern to manage transactions and coordination between microservices. The application consists of the following microservices:

- Inventory Microservice (Inventory μS)
- Order Microservice (Order μS)
- Shipping Microservice (Shipping μS)
- Payment Microservice (Payment μS)
- Catalog Microservice (Catalog μS)
- Shopping Cart Microservice (Shopping Cart μS)
- Saga Orchestrator
- Discovery Server
- API Gateway

I have chosen RabbitMQ as the Message Broker to handle communication between the microservices and an orchestrator that manages the messages and sends actions to each microservice.

## Choice of Saga Pattern

I have chosen the orchestration-based saga pattern for the application. This decision was made because it provides a centralized approach to managing transactions, making it easier to monitor and control the overall flow of the process. The orchestrator in this pattern is responsible for sending commands to individual microservices and handling the events generated by them.

## State Machine and Order Process

The following is a description of the state machine and order process, detailing the possible states and transitions between them:

**Order Created**: The process starts with the order.out.ORDER_CREATED event. This event is published when a new order is successfully created.

**Decrease Stock**: The Inventory Microservice receives the inventory.in.DECREASE_STOCK command and attempts to decrease the stock of the ordered items.

- Stock Decreased: If the stock is successfully decreased, the inventory.out.STOCK_DECREASED event is published.

- Decrease Stock Failed: If the stock decrease fails, the inventory.out.DECREASE_STOCK_FAILED event is published. This leads to order cancellation and triggers the payment.in.CANCEL_PAYMENT command.

**Create Payment**: If the stock decrease is successful, the Payment Microservice receives the payment.in.CREATE_PAYMENT command to process the payment.

- Payment Created: If the payment is successfully processed, the payment.out.PAYMENT_CREATED event is published.

- Payment Failed: If the payment fails, the payment.out.PAYMENT_FAILED event is published. This triggers the inventory.in.REVERT_DECREASED_STOCK command to revert the stock decrease and leads to order cancellation.

**Send Order** : If the payment is successful, the Shipping Microservice receives the shipping.in.SEND_ORDER command to ship the order.

- Send Order Failed: If the shipping process fails, the shipping.out.SEND_ORDER_FAILED event is published. This triggers the inventory.in.REVERT_DECREASED_STOCK command to revert the stock decrease and leads to order cancellation.

**Order Completed**: If all the steps are successfully executed, the order is considered complete.

The state machine allows for proper handling of failures and ensures that the system remains consistent even in the case of partial failures.
